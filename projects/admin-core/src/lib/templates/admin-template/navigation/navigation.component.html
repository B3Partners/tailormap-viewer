<ng-template #menuButton let-buttonPropsInput>
  <ng-container *ngIf="getButtonProps(buttonPropsInput) as buttonProps">
    <button mat-flat-button
            class="menu-button"
            [routerLink]="'/' + buttonProps.link"
            routerLinkActive="active"
            [routerLinkActiveOptions]="{exact: buttonProps.matchExact}"
            [tmTooltip]="buttonProps.label"
            [class.has-submenu]="buttonProps.subMenu"
            matTooltipPosition="right">
      <mat-icon *ngIf="buttonProps.icon" [svgIcon]="buttonProps.icon"></mat-icon>
      <span *ngIf="buttonProps.label" class="menu-button-label">{{ buttonProps.label }}</span>
    </button>
    <div *ngIf="buttonProps.subMenu" class="submenu">
      <ng-container *ngFor="let subMenu of buttonProps.subMenu">
        <ng-container *ngTemplateOutlet="menuButton; context: {$implicit: subMenu}"></ng-container>
      </ng-container>
    </div>
  </ng-container>
</ng-template>

<div class="navigation-bar">
  <ng-container *ngFor="let menu of buttons$ | async">
    <ng-container *ngTemplateOutlet="menuButton; context: {$implicit: menu}"></ng-container>
  </ng-container>

  <div class="divider"></div>

  <ng-container *ngIf="userDetails$ | async as userDetails">
    <button mat-flat-button
            class="menu-button"
            [matMenuTriggerFor]="userMenu"
            [tmTooltip]="userDetails.isAuthenticated && userDetails.username ? userDetails.username : loginLabel"
            matTooltipPosition="right">
      <mat-icon [svgIcon]="userDetails.isAuthenticated ? 'user' : 'login'"></mat-icon>
      <span class="menu-button-label">{{userDetails.isAuthenticated && userDetails.username ? userDetails.username : loginLabel}}</span>
    </button>
    <mat-menu #userMenu="matMenu" xPosition="before" yPosition="above">
      <button mat-menu-item (click)="logout()" *ngIf="userDetails.isAuthenticated && userDetails.username">
        <span i18n>Logout</span>
      </button>
      <button mat-menu-item (click)="login()" *ngIf="!userDetails.isAuthenticated">
        <span>{{loginLabel}}</span>
      </button>
    </mat-menu>
  </ng-container>

</div>
