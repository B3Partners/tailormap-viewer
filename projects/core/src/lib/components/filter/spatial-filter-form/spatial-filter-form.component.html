<h2 i18n>Add spatial filter</h2>

<ng-template #formTemplate let-availableLayers>

  <ng-template #noLayers>
    <div i18n>No layers available to filter on</div>
  </ng-template>

  <ng-container *ngIf="availableLayers.length > 0; else: noLayers">

    <div class="form-section form-section--with-form-field">
      <tm-spatial-filter-form-select-layers></tm-spatial-filter-form-select-layers>
    </div>

    <div class="form-section" *ngIf="hasSelectedLayers$ | async">
      <div i18n class="form-section-label">Draw filter geometry</div>
      <tm-spatial-filter-form-draw-geometries [drawingLayerId]="drawingLayerId"></tm-spatial-filter-form-draw-geometries>
    </div>

    <div class="form-section" *ngIf="hasSelectedLayers$ | async">
      <div i18n class="form-section-label">or select reference layer</div>
      <tm-spatial-filter-form-select-reference-layer></tm-spatial-filter-form-select-reference-layer>
    </div>

    <div class="form-section form-section--with-form-field" *ngIf="hasSelectedLayersAndGeometry$ | async">
      <div i18n class="form-section-label">Set optional buffer</div>
      <tm-spatial-filter-form-buffer></tm-spatial-filter-form-buffer>
    </div>

    <div class="form-section buttons">

      <ng-template #cancelButton>
        <button mat-stroked-button
                (click)="cancel()"
                tmTooltip="Close filter form"
                i18n-tmTooltip
                i18n>Cancel</button>
      </ng-template>
      <ng-container *ngIf="currentGroup$ | async as currentGroup; else cancelButton">
        <button mat-stroked-button
                color="warn"
                (click)="remove(currentGroup)"
                tmTooltip="Remove this filter"
                i18n-tmTooltip
                i18n>Remove</button>
        <button mat-flat-button
                color="primary"
                (click)="save()"
                tmTooltip="Save filter"
                i18n-tmTooltip
                i18n>Save</button>
      </ng-container>
    </div>
  </ng-container>
</ng-template>

<ng-container *ngTemplateOutlet="formTemplate; context: { $implicit: availableLayers$ | async }"></ng-container>
